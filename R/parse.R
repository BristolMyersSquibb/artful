#' Remove empty rows
#'
#' This function removes empty rows (where all cells are empty strings) inside a
#' data frame generated by calling [rtf_to_html()].
#'
#' @param data A data frame generated by calling [rtf_to_html()].
#'
#' @return A data frame with empty rows removed.
#'
#' @keywords internal
strip_empty_rows <- function(data) {
  filter(data, !if_all(everything(), ~ . == ""))
}

#' Remove the header
#'
#' This function removes the rows representing a header (e.g., titles and
#' subtitles) inside a data frame generated by calling [rtf_to_html()].
#'
#' @param data A data frame generated by calling [rtf_to_html()].
#'
#' @return A data frame with the header removed.
#'
#' @keywords internal
strip_header <- function(data) {
  # The second+ columns are populated with empty strings "" alongside the
  # header information which can be used to determine the row indices of the
  # header:
  header_last_row <- min(which(data[[2]] != "" | is.na(data))) - 1

  # Some tables repeat across pages in the original RTF. This results in
  # data frames containing combined data frames with headers that repeat across
  # several points. Capture the original header:
  header_values <- data[[1]][1:header_last_row]

  # Remove all copies of the header:
  data[data[[1]] %!in% header_values, ]
}

#' Remove the footer
#'
#' This function removes the rows representing a footer inside a data frame
#' generated by calling [rtf_to_html()].
#'
#' @param data A data frame generated by calling [rtf_to_html()].
#'
#' @return A data frame with the footer removed.
#'
#' @keywords internal
strip_footer <- function(data) {
  # The last row in the third column that is not an empty string signals the
  # last row before the footer. All following rows until the end of the data
  # frame are populated with empty strings alonside the footer values in
  # the first column.
  footer_first_row <- max(which(data[[3]] != "" | is.na(data[[3]]))) + 1

  # Some tables repeat across pages in the original RTF. This results in
  # data frames containing combined data frames with footers that repeat across
  # several points. Capture the original footer:
  footer_values <- data[[1]][footer_first_row:nrow(data)]
  data[data[[1]] %!in% footer_values, ]
}

#' Remove repeat column names
#'
#' This function removes columns names that repeat across multiple rows (caused
#' by pagination in the original RTF files) inside a data frame generated by
#' calling [rtf_to_html()]. Only the first occurance should be kept.
#'
#' @param data A data frame generated by calling [rtf_to_html()].
#'
#' @return A data frame with the repeat column names removed.
#'
#' @keywords internal
strip_colnames <- function(data) {
  # This assumes column names are in the first row (which is the case if this
  # function is called after calling `strip_header()`)
  first_row <- dplyr::slice(data, 1L)
  remaining_rows <- dplyr::slice(data, -1L)

  remaining_rows_without_colnames <- remaining_rows |>
    dplyr::anti_join(first_row)

  dplyr::bind_rows(first_row, remaining_rows_without_colnames)
}

#' Separate a single indented column into multiple columns
#'
#' This function separates a single indented column into multiple columns inside
#' a data frame generated by calling [rtf_to_html()]
#'
#' @param data A data frame generated by calling [rtf_to_html()].
#'
#' @return A data frame where indented columns have been separated.
#'
#' @keywords internal
separate_indentation <- function(data) {
  # Placeholder
}

#' Separate a merged columns into multiple columns
#'
#' This function separates columns containing merged values (e.g., where a count
#' and percentage are merged into a single string such as "34 (.56)") into
#' multiple columns inside a data frame generated by calling [rtf_to_html()].
#'
#' @param data A data frame generated by calling [rtf_to_html()].
#'
#' @return A data frame where merged columns have been separated.
#'
#' @keywords internal
separate_merges <- function(data) {
  # Placeholder
}

#' Separate a spanner
#'
#' This function separates spanning column labels out inside a data frame
#' generated by calling [rtf_to_html()]. A spanning column header represents a
#' unique grouping identifier for the columns it spans over.
#'
#' @param data A data frame generated by calling [rtf_to_html()].
#'
#' @return A data frame where merged columns have been separated.
#'
#' @keywords internal
separate_spanners <- function(data) {
  # Placeholder
}
